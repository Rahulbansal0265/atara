<% if(session.type==1){ %>
    <%-include('../partials/header')%>
<%}else{%>
    <%- include ("../subAdmin/partials/header") %>
<%}%>

<div class="page-container">

    <div class="page-content">

        <% if(session.type==1){ %>
            <%-include('../partials/sidebar')%>
        <%}else{%>
            <%- include ("../subAdmin/partials/sidebar") %>
        <%}%>

    <div class="content-wrapper">

                            <!-- Page header -->
                            <div class="page-header page-header-default">
                                <div class="page-header-content">
                                    <div class="page-title">
                                        <h4>
                                            <a href="javascript:history.go(-1);"><i
                                                    class="icon-arrow-left52 position-left"></i></a><span
                                                class="text-semibold">Home</span> - Offer</h4>
                                    </div>

                                </div>

                            </div>
                            <!-- /page header -->

                            <!-- Content area -->
                            <div class="content">





                                <div class="panel panel-flat">
                                    <!-- <div class="panel-heading">


                                <h1 class="panel-title">Form</h1>


                            </div> -->


                                    <div class="panel-body">


    <form id="categoryvalidation" class="form-horizontal categoryvalidation" action="/createoffer"
                                            enctype="multipart/form-data" method="post">
                                            <fieldset class="content-group">
                                                <legend class="text-bold">Add Offers</legend>
                                                <div class="form-group">
                                                    

                                                    <label class="control-label col-lg-2" for="pro ">Choose Business :</label>
                                                    <div class="col-lg-10">
        
                                                        <select class="form-control " data-placeholder="Choose business..."  name="business_id">
                                                                <option class="dropdown-item" disabled="disabled" selected="selected"> Select </option>
                                                            <% businesses.forEach((value)=>{%>

                                                                <option class="dropdown-item" value="<%= value.id%>">
                                                                    <%=value.name%>
                                                                </option>
        
                                                                <%})%>
                                                        </select>
                                                    </div>
                                                </div>

                                                <div class="form-group">
                                                    <label class="control-label col-lg-2">Title<span
                                                            class="text-danger">*</span></label>
                                                    <div class="col-lg-10">
                                                        <input type="text" name="title" id="title" class="form-control title"
                                                            placeholder="Enter title">
                                                    </div>
                                                </div>
                                                
                                                <!-- <div class="form-group">
                                                    <label class="control-label col-lg-2">Image<span
                                                        class="text-danger">*</span></label>
                                                        <img id="blah" src="/dummy/dummy.jpeg" alt="your image"
                                                        width="100" height="100" />
                                                    <div class="col-lg-10">

                                                        <input type="file" class="control-label col-lg-3" name="image"
                                                            accept="image/*"  id="imgInp">
                                                    </div>


                                                </div> -->

                                                <!-- <div class="form-group">
                                                    <label class="control-label col-lg-2">Location<span
                                                            class="text-danger">*</span></label>
                                                    <div class="col-lg-10">
                                                        <input type="text" name="location" id="location" class="form-control"
                                                            placeholder="Enter location" required>
                                                    </div>
                                                </div> -->

                                                <!-- <div class="form-group">
                                                    <label class="control-label col-lg-2">Description<span
                                                            class="text-danger">*</span></label>
                                                    <div class="col-lg-10">
                                                        <input type="text" name="description" id="description" class="form-control"
                                                            placeholder="Enter description" required>
                                                    </div>
                                                </div> -->

                                                <!-- <div class="form-group">
                                                    <label class="control-label col-lg-2">Resturant Time Detail<span
                                                            class="text-danger">*</span></label>
                                                    <div class="col-lg-10">
                                                        <input type="time" name="time" id="time" class="form-control"
                                                            placeholder="Enter resturant time detail" required>
                                                    </div>
                                                </div> -->

                                                <!-- <div class="form-group">
                                                    <label class="control-label col-lg-2">Social Media Link<span
                                                            class="text-danger">*</span></label>
                                                    <div class="col-lg-10">
                                                        <input type="url" name="social_media_link" id="social_media_link" class="form-control"
                                                            placeholder="Enter media link" required>
                                                    </div>
                                                </div> -->
                                                
                                                <div class="form-group">
                                                    <label class="control-label col-lg-2">Condition<span
                                                            class="text-danger">*</span></label>
                                                    <div class="col-lg-10">
                                                        <textarea class="form-control" name="offer_condition" id="offer_condition" cols="80"label="offer_condition" rows="5" wrap="virtual"></textarea>
                                                        
                                                            
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label class="control-label col-lg-2">Offer<span
                                                            class="text-danger">*</span></label>
                                                    <div class="col-lg-10">
                                                        <input type="text" name="offer" id="offer" class="form-control"
                                                            placeholder="Enter offer" required>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label class="control-label col-lg-2">Brief<span
                                                            class="text-danger">*</span></label>
                                                    <div class="col-lg-10">
                                                        <input type="text" name="brief" id="brief" class="form-control"
                                                            placeholder="Enter brief/description" required>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label class="control-label col-lg-2">Image<span
                                                        class="text-danger">*</span></label>
                                                    <div class="col-lg-10">
                                                        <input type="file" class="control-label col-lg-3 form-control" name="image"
                                                            accept="image/*"  id="imgInp">
                                                            <!-- <img id="blah" src="#" alt="your image" /> -->
                                                    </div>
                                                    <input type="hidden" id="file" value="">
                                                    <!-- <div class="col-sm-5">
                                                        img id="blah" src="/download.jpeg" alt="your image" width="50" height="38" /> 
                                                    </div> -->
                                                </div>
                                                 <div class="addSubRenovationInput">
                                                  
                                                 
                                                </div>

                                                 <!-- <div class="form-group">   
                                                    <br>
                                                    <button type="button" class="btn btn-primary" onclick="addMore()" id="addSubRenovation">Add More</button>  
                                                </div>   -->

                                                

                                                <div class="text-right">
                                                    <% if(type === 1 || (type === 4 &&  permi.indexOf('add') >= 0)) { %>
                                                 
                                                    <button type="submit" class="btn btn-primary">Add</button>
                                                            <a href="/admin/offers" style="background-color: #8080808c; color: black;" type="submit" class="btn btn-secondary">
                                                                Back
                                                            </a>
                                                <% } %>

                                                </div>
                                            </fieldset>
                                        </form>


<% if(session.type==1){ %>
    <%-include('../partials/footer')%>
<%}else{%>
    <%- include ("../subAdmin/partials/footer") %>
<%}%>

                            </div>
                            <!-- /content area -->

                        </div>
                        <!-- /main content -->

                </div>
                <!-- /page content -->

            </div>
            <!-- /page container -->

            </body>

            </html>

            
<script type="text/javascript">
    $(document).ready(function () {

$(document).on('click','.delBtn',function () {
  console.log('i am clicked')
  console.log($(this).parent('div'),'---$(this).parent(div)--');
  $(this).parent('div').remove();
})

});

imgInp.onchange = evt => {
  const [file] = imgInp.files
  if (file) {
    blah.src = URL.createObjectURL(file)
  }
}






var i=0;
function addMore(){
    i+=1;
    // $(".addSubRenovationInput div").each(function() {console.log(this,); });
  let html = ``;
    html += `<div id="add_more_div_${i}">
        <div class="form-group">
            <label class="control-label col-lg-2">Title<span class="text-danger">*</span></label>
            <div class="col-lg-10">
            <input type="text" class="form-control sub_name title" name="title" id="title_${i}" placeholder="Title"> &nbsp; &nbsp; &nbsp;
            <div class="title_${i} error"></div>
            </div>
        </div>
        

        <div class="form-group">
            <label class="control-label col-lg-2">Condition<span class="text-danger">*</span></label>
            <div class="col-lg-10">

        <textarea class="form-control" name="offer_condition"  id="offer_condition_${i}" cols="80"label="offer_condition" rows="5" wrap="virtual"></textarea> &nbsp; &nbsp; &nbsp;
        <div class="offer_condition_${i} error"></div>
            </div>
        </div>

        <div class="form-group">
            <label class="control-label col-lg-2">Offer<span
                    class="text-danger">*</span></label>
            <div class="col-lg-10">
                <input type="text" name="offer" id="offer_${i}" class="form-control"
                    placeholder="Enter offer">
                    <div class="offer_${i} error"></div>
            </div>
        </div>

        <div class="form-group">
            <label class="control-label col-lg-2">Brief<span
                    class="text-danger">*</span></label>
            <div class="col-lg-10">
                <input type="text" name="brief" id="brief_${i}" class="form-control"
                    placeholder="Enter offer">
                    <div class="brief_${i} error"></div>
            </div>
        </div>
        
        <div class="input-group-prepend delBtn">
          <div class="input-group-text" style="color: red;">
            <button class="btn btn-danger onclick=removeAddMore(${i})">Remove</button
            
          </div>
        </div>
        
        </div>`;

  $(".addSubRenovationInput").append(html);
}


 $("#categoryvalidation").validate({

        // ignore: [],
        // Specify validation rules
        rules: {

            business_id: {
            required: true,
            
         },
            
            title: {
            required: true,
            minlength: 3,
            //  maxlength: 15,
            noSpace : true
         },
        
         
         offer_condition: {
            required: true,
            noSpace : true
         },
          offer: {
            required: true,
         },
         brief: {
            required: true,
         },
         
         

              
        },
        messages: {
              
            
            business_id: {
            required: " Please select business",
            accept: "Please select a vaild business "
         },
         title: {
            required: " Please enter title",
            accept: "Please enter a vaild title "
         },
        
         
         offer_condition: {
            required: " Please enter offer condition",
            accept: "Please enter a vaild offer condition "
         },
         offer: {
            required: " Please enter offer",
            accept: "Please enter a vaild offer "
         },
         
         brief: {
          required: "Please enter brief/description",
          accept: "Please enter a vaild brief/description "
         },   

        },
        submitHandler: function (form) { 
        // console.log(form,"lll")
            var input;
        var textarea;
        
        var inputArr=[];
        var textArr=[];
        $(".addSubRenovationInput input").each(function() {
            inputArr.push(this.id)
            if($(`#${this.id}`).val()==''){
                $(`.${this.id}`).html("This field is required")
                input=false
            }else{
                $(`.${this.id}`).html("")
                input=true
            }
            
           });

          $(".addSubRenovationInput textarea").each(function() {
            textArr.push(this.id)
            if($(`#${this.id}`).val()==''){
                $(`.${this.id}`).html("This field is required")
                textarea=false
            }else{
                 $(`.${this.id}`).html("")
                textarea=true
            }
        })

        if(inputArr.length>0 && textArr.length>0){
            if(input && textarea){
                return true
            }else{
                return false
            }
        }else{
            return true
        }

        
    }
})



</script>

<script>
    $(document).ready(function(){
         
      jQuery.validator.addMethod("noSpace", function(value, element) {
        return value == '' || value.trim().length != 0;
      }, "Space shouldn't be allowed");




     
})
//  submitHandler: function (form) { // for demo
        //     return false;
//           $(".addSubRenovationInput input").each(function() {
//             console.log(this)
//             if($(`#${this.id}`).val()==''){
//                 $( "<div class='error'>This field is required</div>" ).insertAfter( `#${this.id}` );
//             }
//            });
//           $(".addSubRenovationInput textarea").each(function() {
//             if($(`#${this.id}`).val()==''){
//                 $( "<div class='error'>This field is required</div>" ).insertAfter( `#${this.id}` );
//             }
// return false
            
//            });
            // return false;  // for demo
        // }
      
    //   });
</script>





