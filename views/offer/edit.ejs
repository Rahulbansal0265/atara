


<% if(session.type==1){ %>
    <%-include('../partials/header')%>
<%}else{%>
    <%- include ("../subAdmin/partials/header") %>
<%}%>
            <!-- /main navbar -->

            <!-- Page container -->
            <div class="page-container">

                <!-- Page content -->
                <div class="page-content">

                    <!-- Main sidebar -->
                    <% if(session.type==1){ %>
                        <%-include('../partials/sidebar')%>
                    <%}else{%>
                        <%- include ("../subAdmin/partials/sidebar") %>
                    <%}%>
                        <!-- /main sidebar -->

                        <!-- Main content -->
                        <div class="content-wrapper">

                            <!-- Page header -->
                            <div class="page-header page-header-default">
                                <div class="page-header-content">
                                    <div class="page-title">
                                        <h4>
                                            <a href="javascript:history.go(-1);"><i
                                                    class="icon-arrow-left52 position-left"></i></a><span
                                                class="text-semibold">Home</span> - Offer</h4>
                                    </div>

                                </div>

                            </div>
                            <!-- /page header -->

                            <!-- Content area -->
                            <div class="content">





                                <div class="panel panel-flat">
                                    <!-- <div class="panel-heading">


                                <h1 class="panel-title">Form</h1>


                            </div> -->


                                    <div class="panel-body">

                                        <form id="subcategoryvalidation" class="form-horizontal" action="/updateoffer/<%-editoffer.id%>"
                                            enctype="multipart/form-data" method="post">
                                            <fieldset class="content-group">
                                                <legend class="text-bold">Edit Offer</legend>
                                                

                                                <div class="form-group">
                                                    <label class="control-label col-lg-2" for="category ">Choose Business :</label>
                                                    <div class="col-lg-10">
        
                                                        <select class="form-control " data-placeholder="Choose business..."  name="category_id">
        
                                                            <% for(let i in businesses) { %>
                        
                                                                <option  value="<%=businesses[i].id%>" <%= (businesses[i].id == editoffer.business_id)?'selected':'' %>><%=businesses[i].name%></option>
                                                                    <% } %>
                                                        </select>
                                                    </div>
                                                </div>
                                                <!-- <div class="form-group " >
                                                    <label class="control-label col-lg-2">Title<span
                                                            class="text-danger">*</span></label>
                                                    <div class="col-lg-10">
                                                         <% for(let i in data) { %>
                                                            <input type="text" name="title" id="title" class="form-control"
                                                           value="<%=data[i].title%>">
                                                                
                                                                    <% } %>
                                                        
                                                    </div>
                                                </div> -->
                                               
                                                <!-- <div class="form-group " >
                                                    <label class="control-label col-lg-2">Condition<span
                                                            class="text-danger">*</span></label>
                                                    <div class="col-lg-10">
                                                        <% for(let i in data) { %>
                                                       
                                                           <textarea class="form-control" name="offer_condition" cols="80"label="offer_condition" rows="4" wrap="virtual"><%=data[i].offer_condition%></textarea>
                                                           <% } %>

                                                    </div>
                                                </div> -->
                                                <!-- <div class="form-group">
                                                    <label class="control-label col-lg-2">Offer<span
                                                            class="text-danger">*</span></label>
                                                    <div class="col-lg-10">
                                                        <% for(let i in data) { %>
                                                        <input type="text" name="offer" id="offer" class="form-control"
                                                           value="<%=data[i].offer%>">
                                                           <% } %>
                                                    </div>
                                                </div> -->

                                                <!-- <div class="form-group">
                                                    <label class="control-label col-lg-2">Brief<span
                                                            class="text-danger">*</span></label>
                                                    <div class="col-lg-10">
                                                        <% for(let i in data) { %>
                                                            <input type="text" name="brief" id="brief" class="form-control"
                                                               value="<%=data[i].brief%>">
                                                               <% } %>
                                                        
                                                    </div>
                                                </div> -->
                                                  
                                                <div class="form-group addSubRenovationInput addInput">
                                                  
                                                    <div class="input-group">
                                                      <input type="hidden" class="form-control sub_name" name="no_guest" placeholder=" sub no of guest"> 
                                                      &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;
                                                    </div>
                                                  </div>

                                                <div class="form-group row mb-4 addBtn">
                                                  <div class="col-sm-12 col-md-7 offset-10">
                                                    <button type="button" onclick="addOffer()" class="btn btn-success" id="addSubRenovation">Add more</button>
                                                  </div>
                                                </div>

                                                <div class="text-right">

                                                    <button type="submit" class="btn btn-primary">Update<i
                                                            class="icon-arrow-right14 position-right"></i></button>
                                                </div>
                                            </fieldset>
                                        </form>
                                    </div>
                                </div>


                                <div class="panel panel-flat">
                                    <div class="panel-heading">
                                        <h3 class="panel-title">Offer's Edit</h3>
        
                                    </div>
        
                                  
                                 
        
                                    <table id="myTable" class="table datatable-selection-single">
                                        <thead>
                                            <tr>
                                                <th>Sr. No.</th>
                                                <th>Title</th>
                                                <th>Condition</th>
                                                <th>Offer</th>
                                                <th>Brief</th>
                                                <th>Status</th>
                                                <th>Action</th>
                                               
                                            </tr>
                                        </thead>
        
        
                                       <tbody>
                                                                    <% 
                                                                    var index=0;
                                                                    for(let i in offerMultiplesArr){
                                                                        index+=1
                                                                        %>
<tr>
                                                                            <td>
                                                                                <%= index %>
                                                                            </td>

                                                                            <td>
                                                                                <%= offerMultiplesArr[i].title %>

                                                                            </td>
                                                                            <td>
                                                                                <%- offerMultiplesArr[i].offer_condition.length < 25 ?
                                                                                    offerMultiplesArr[i].offer_condition :
                                                                                    `${offerMultiplesArr[i].offer_condition.slice(0,25)}
                                                                                    ... `%>

                                                                                    <%if(offerMultiplesArr[i].offer_condition.length> 25
                                                                                        ){%>
                                                                                        <a class="btn btn-primary"
                                                                                            onclick="openModal('Condition',`<%= offerMultiplesArr[i].offer_condition %> `)">
                                                                                            Read
                                                                                        </a>
                                                                                        <%}%>


                                                                            </td>
                                                                            <td>
                                                                                <%= offerMultiplesArr[i].offer.length < 25 ? offerMultiplesArr[i].offer
                                                                                    : `${offerMultiplesArr[i].offer.slice(0,25)} ... `%>

                                                                                    <%if(offerMultiplesArr[i].offer.length> 25 ){%>
                                                                                        <a class="btn btn-primary"
                                                                                            onclick="openModal('Offer','<%= offerMultiplesArr[i].offer %>')">
                                                                                            Read
                                                                                        </a>
                                                                                        <%}%>

                                                                            </td>
                                                                            <td>
                                                                                <%= offerMultiplesArr[i].brief.length < 25 ? offerMultiplesArr[i].brief
                                                                                    : `${offerMultiplesArr[i].brief.slice(0,25)} ... `%>

                                                                                    <%if(offerMultiplesArr[i].brief.length> 25 ){%>
                                                                                        <a class="btn btn-primary"
                                                                                            onclick="openModal('Brief','<%= offerMultiplesArr[i].brief %>')">
                                                                                            Read
                                                                                        </a>
                                                                                        <%}%>

                                                                            </td>

 <td>
                                                        <% if(offerMultiplesArr[i].status==0) { %>
                                                            <button class="btn btn-danger working "
                                                                data-id="<%=offerMultiplesArr[i].id%>" value="1">Inactive</button>
                                                        <% } else { %>
                                                        <button class="btn btn-success working"
                                                    data-id="<%=offerMultiplesArr[i].id%>" value="0" style="display: flex;
                                                        margin: 5px">Active</button>
                                                        <% } %>
                                                         
        
                                                    </td>
                                                    <td>
                                                        
                                                            <a href="/editoffermulti/<%=offerMultiplesArr[i].id%>" class="btn btn-primary"><i
                                                           class="icon-pencil"></i></a>
                                                           
                                                                <button onclick="confirmDelete('<%=offerMultiplesArr[i].id%>')" class="btn btn-danger 
                                                                   deletdat>"><i class="icon-trash Delete"></i></button>
                                                                    
                                                          
                                                    </td> 
                                                                        </tr>
                                                                        <% } %>
                                                                </tbody>


        
                                    </table>
        
        
                                </div>



                                <!-- Footer -->
                                <% if(session.type==1){ %>
                                    <%-include('../partials/footer')%>
                                <%}else{%>
                                    <%- include ("../subAdmin/partials/footer") %>
                                <%}%>
                                    <!-- /footer -->

                            </div>
                            <!-- /content area -->

                        </div>
                        <!-- /main content -->


<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body" id="data_content">
        ...
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

                </div>
                <!-- /page content -->

            </div>
            <!-- /page container -->

            </body>

            </html>
              <script>
    $(document).ready(function(){
         
      jQuery.validator.addMethod("noSpace", function(value, element) {
        return value == '' || value.trim().length != 0;
      }, "Space shouldn't be allowed");


      $("#subcategoryvalidation").validate({

        ignore: [],
        // Specify validation rules
        rules: {
            
            title: {
            required: true,
            minlength: 3,
             maxlength: 15,
            noSpace : true
         },
        
         offer: {
            required: true,
            noSpace : true
         },
         offer_condition: {
            required: true,
            noSpace : true
         },

         brief: {
            required: true,
            noSpace : true
         },
         
         
        

              
        },
        messages: {
        
         title: {
            required: " Please enter title",
            accept: "Please enter a vaild title "
         },
         offer: {
            required: " Please enter offer",
            accept: "Please enter a vaild offer "
         },

        
         offer_condition: {
            required: " Please enter offer condition",
            accept: "Please enter a vaild offer condition "
         },
         
          
        

        },
      
      });
    });
    </script> 



<script type="text/javascript">

    $(document).ready(function () {


$(document).on('click','.delBtn',function () {
  console.log('i am clicked')
  console.log($(this).parent('div'),'---$(this).parent(div)--');
  $(this).parent('div').remove();
})

});
</script>
<script>

function confirmDelete(id) {


    const swalWithBootstrapButtons = Swal.mixin({
        customClass: {
            confirmButton: 'btn btn-danger',
            cancelButton: 'btn btn-success'
        },
        buttonsStyling: false
    })
    console.log("------------------------------result------", id);

    swalWithBootstrapButtons.fire({
        title: 'Are you sure?',
        text: "You won't be able to revert this!",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonText: 'Yes, delete it!',
        cancelButtonText: 'No, cancel!',
        reverseButtons: true
    }).then((isConfirm) => {
        // console.log(isConfirm)
        // return
        if (isConfirm.isConfirmed) {
            // alert('asd')
            $.ajax({

                url: "/deleteoffermultiple",
                method: 'delete',
                data: { id: id },
                success: function (result) {

                }


            });


            swalWithBootstrapButtons.fire(
                'Deleted!',
                'This offer has been deleted.',
                'success'
            ).then(() => {
                location.reload();
            })
        } else {
            swalWithBootstrapButtons.fire(
                'Cancelled',
                'Your imaginary offer is safe :)',
                'error'
            )
        }
    })

}
</script>

<script>



    $(document).ready(function () {
        $('#myTable').DataTable();
    });


    $('.working').click(function () {
     console.log('------status')

    var id = $(this).attr('data-id')
    var value = $(this).attr('value')



        const swalWithBootstrapButtons = Swal.mixin({
            customClass: {
                confirmButton: 'btn btn-danger',
                cancelButton: 'btn btn-success'
            },
            buttonsStyling: false
        })
        console.log("------------------------------result------", id);

        swalWithBootstrapButtons.fire({
            title: 'Are you sure?',
            text: "You can revert this!",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonText: 'Yes, update it!',
            cancelButtonText: 'No, cancel!',
            reverseButtons: true
        }).then((isConfirm) => {
            // console.log(isConfirm)
            // return
            if (isConfirm.isConfirmed) {
                // alert('asd')
                 $.ajax({
        type: "post",
        url: "/updateofferstatusmultiple",
        data: {
            id: id,
            value: value
        },
        success: function (data) {
            location.reload();
           
        }
    });


                swalWithBootstrapButtons.fire(
                    'Deleted!',
                    'This status has been updated.',
                    'success'
                ).then(() => {
                    location.reload();
                })
            } else {
                swalWithBootstrapButtons.fire(
                    'Cancelled',
                    'Your imaginary status is safe :)',
                    'error'
                )
            }
        })


});



var i=0;
function addOffer(){
    i+=1;   
    // $(".addSubRenovationInput div").each(function() {console.log(this,); });
  let html = ``;
    html += `<div id="add_more_div_${i}">
        <div class="form-group">
            <label class="control-label col-lg-2">Title<span class="text-danger">*</span></label>
            <div class="col-lg-10">
            <input type="text" class="form-control sub_name title" name="title" id="title_${i}" placeholder="Title"> &nbsp; &nbsp; &nbsp;
            <div class="title_${i} error"></div>
            </div>
        </div>
        

        <div class="form-group">
            <label class="control-label col-lg-2">Condition<span class="text-danger">*</span></label>
            <div class="col-lg-10">

        <textarea class="form-control" name="offer_condition"  id="offer_condition_${i}" cols="80"label="offer_condition" rows="5" wrap="virtual"></textarea> &nbsp; &nbsp; &nbsp;
        <div class="offer_condition_${i} error"></div>
            </div>
        </div>

        <div class="form-group">
            <label class="control-label col-lg-2">Offer<span
                    class="text-danger">*</span></label>
            <div class="col-lg-10">
                <input type="text" name="offer" id="offer_${i}" class="form-control"
                    placeholder="Enter offer">
                    <div class="offer_${i} error"></div>
            </div>
        </div>

        <div class="form-group">
            <label class="control-label col-lg-2">Brief<span
                    class="text-danger">*</span></label>
            <div class="col-lg-10">
                <input type="text" name="brief" id="brief_${i}" class="form-control"
                    placeholder="Enter offer">
                    <div class="brief_${i} error"></div>
            </div>
        </div>
        
        <div class="input-group-prepend delBtn">
          <div class="input-group-text" style="color: red;">
            <button class="btn btn-danger onclick=removeAddMore(${i})">Remove</button
            
          </div>
        </div>
        
        </div>`;

  $(".addSubRenovationInput").append(html);
}


   

</script>
 <script>
        function openModal(title,body){
          $("#exampleModal").modal({
        show: 'true'
    });
    $("#exampleModalLabel").html(title)
    $("#data_content").html(body)
           
        }
    </script>