<%- include("../partials/header") %>
    <div class="page-container">
        <div class="page-content">
            <%- include("../partials/sidebar") %>
                <div class="content-wrapper">
                    <div class="page-header page-header-default">
                        <div class="page-header-content">
                            <div class="page-title">
                                <h4>
                                    <a href="JavaScript:void(0)">
                                        <i class="icon-arrow-left52 position-left"></i>
                                    </a>
                                    <span class="text-semibold">Statistics</span>
                                </h4>
                            </div>
                        </div>
                    </div>
                    <div class="content">
                        <div class="panel panel-flat">
                            <div class="panel-heading">
                                <h3 class="panel-title">Listing</h3>
                            </div>
                            <input type="hidden" id="permission" value="<%= JSON.stringify(global.permission) %>">
                            <input type="hidden" id="type" value="<%= global.type %>">
                            <table id="influencer_datatable" class="table datatable-selection-single">
                                <thead>
                                    <tr>
                                        <th class="text-center">Sr. No.</th>
                                        <th class="text-center">Influencer Name</th>
                                        <th class="text-center">Average View</th>
                                        <th class="text-center" data-orderable="false">
                                            Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <% 
                                    var j=0
                                        for(let i in influencerStatisticsArr){ %>
                                        <tr>
                                            <td class="text-center">
                                                <%= j+=1 %>
                                            </td>
                                            <td class="text-center">
                                                <%=influencerStatisticsArr[i].user.full_name%>
                                            </td>
                                            <td class="text-center">
                                                <%=influencerStatisticsArr[i].view_avg%>
                                            </td>
                                            <td style="text-align:center;">
                                                

                                                <% 
                                                if(global.type==4){
                                                if(global.permission!='' && "influencer_statistic" in global.permission.child &&
                                                    global.permission.child.influencer_statistic.includes('edit')){ %>
                                                <a title="Edit"
                                                    href="/admin/influencers/influencer/<%=influencerStatisticsArr[i].id%>"
                                                    class="btn btn-primary"><i class="fas fa-edit"></i></a>
                                                    <% } %>

                                                    <% if(global.permission!='' && "influencer_statistic" in global.permission.child &&
                                                        global.permission.child.influencer_statistic.includes('view')){ %>
                                                <a title="View"
                                                    href="/admin/influencers/view/<%=influencerStatisticsArr[i].id%>"
                                                    class="btn btn-primary"><i class="fas fa-eye"></i></a>
                                                    <% } %>
                                                    <% if(global.permission!='' && "influencer_statistic" in global.permission.child &&
                                                        global.permission.child.influencer_statistic.includes('delete')){ %>
                                                <a title="Delete"
                                                    onclick="deleteInfluencer('<%=influencerStatisticsArr[i].id%>')"
                                                    class="btn btn-danger"><i class="fas fa-trash"></i></a>
                                                    <% } }else{ %>
                                                        <a title="Edit" href="/admin/influencers/influencer/<%=influencerStatisticsArr[i].id%>" class="btn btn-primary"><i
                                                                class="fas fa-edit"></i></a>
                                                                <a title="View" href="/admin/influencers/view/<%=influencerStatisticsArr[i].id%>" class="btn btn-primary"><i
                                                                        class="fas fa-eye"></i></a>
                                                                        <a title="Delete" onclick="deleteInfluencer('<%=influencerStatisticsArr[i].id%>')" class="btn btn-danger"><i
                                                                                class="fas fa-trash"></i></a>
                                                        <% } %>
                                            </td>
                                        </tr>
                                        <%}%>
                                </tbody>
                            </table>
                        </div>
                        <%- include ("../partials/footer") %>
                    </div>
                </div>
        </div>
    </div>
    <script>
        function deleteInfluencer(id) {
            bootbox.confirm("Do you really want to delete influencer statistics?", function (result) {
                if (result) {
                    $.post("/admin/influencers/delete", { id: id }, function (data, status) {
                        if (data) {
                            // $(".table").load(location.href + " .table");
                            var message = "Influencer statistic deleted successfully";
                            location.reload()
                            // iziToast.success({
                            //     title: "Success",
                            //     message: message,
                            //     position: "topRight",
                            // });
                        }
                    });
                }
            });
        }

        var table = $("#influencer_datatable").DataTable()
        var permissionStringify=$("#permission").val()
        var type=$("#type").val()
        if(type==4){
            var permission = JSON.parse($("#permission").val())

            if (permission != '' && "influencer_statistic" in permission.child &&
                permission.child.influencer_statistic.includes('add')) {

                $("#influencer_datatable").before("<div class='row'><div class='col-sm-5' id='search_field'></div><div class='col-sm-6' id='add_icon'></div></div>");
                $("#influencer_datatable_length").appendTo($("#search_field"));
                $("#influencer_datatable_filter").appendTo($("#add_icon"));
                $('#add_icon').after('<div class="addp"><a title="Add" href="/admin/influencers/influencer"><i class="">+</i></a></div>');
            }
        }else{
            console.log("asdasdasads")
            $("#influencer_datatable").before("<div class='row'><div class='col-sm-5' id='search_field'></div><div class='col-sm-6' id='add_icon'></div></div>");
            $("#influencer_datatable_length").appendTo($("#search_field"));
            $("#influencer_datatable_filter").appendTo($("#add_icon"));
            $('#add_icon').after('<div class="addp"><a title="Add" href="/admin/influencers/influencer"><i class="">+</i></a></div>');
        }
        
        
    </script>

    </body>

    </html>